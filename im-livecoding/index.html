<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>在线代码题demo</title>
  <link rel="stylesheet" href="./css/style.css?v=1">
</head>
<body>
    <div class="container">
        <h3 style="text-align:center;">习题-创建image图形</h3>
        <div id="files-selector">
            <ul class="file-selector-description">
                <li class="tab z-selected">index.html</li>
                <li class="tab">app.js</li> 
            </ul>
           
        </div>
        <pre id="editor">
        </pre>
        <div id="evaluate">
            <h5>效果</h5>
            <iframe frameborder="0"></iframe>
        </div>
        <div class="operation">
            <input type="button" class="btn" onClick="testAnswer();" value="测试答案"/>
            <input type="button" class="btn-primary btn" onClick="submitAnswer();" value="提交答案"/>
        </div>
    </div>

    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<!-- load emmet code and snippets compiled for browser -->
<script src="https://cloud9ide.github.io/emmet-core/emmet.js"></script>

<!-- load ace -->
<script src="./js/ace/ace.js"></script>
<!-- load ace emmet extension -->
<script src="./js/ace/ext-emmet.js"></script>
<script>
    var doc = document;
    var $evaluate = $('#evaluate');
    var editor = ace.edit("editor");
    editor.$blockScrolling = Infinity;
    var sources = [
        {
            name: 'index.html',
            mode: 'ace/mode/html',
            text: '<!--\n简单的image标签创建如下:\n<img src="http://somewebsite.com/image.jpg" alt="short description">\n那么如何完成本次练习:\n* 在段落标签的下面创建指定的img标签.\n* 设置img的图片来源为: http://imweb.io/public/images/logo-white.png\n* 设置图片的描述alt属性为"test").\n* 设置img的id为#image.\n-->\n\n\n<div>\n\tThis is a big paragraph of text about Udacity. Cool. Cool. And here is an image!\n\t<!-- put the image element here! -->\n</div>'
                    
        },
        {
            name: 'app.js',
            mode: 'ace/mode/javascript',
            text: "/*本习题，需要你帮生成的img标签加上\"test-image\"的class名称\n并设置image的宽度为60px.\n*/\nvar image = $();",
                    
        }
    ]; 


    function setEditor(source) {
        editor.session.setMode(source.mode);
        editor.setValue(source.text); 
        // enable emmet on the current editor
        if (source.mode.indexOf('html') !== -1) {
            editor.setOption("enableEmmet", true);
        }
    }


    function submitAnswer() {
        testAnswer();
    }

    function testAnswer() {
        $evaluate.show();
        saveValue();
        $evaluate.find('iframe').attr('src', './evaluate.html');
    }


    function saveValue() {
        var currentValue = editor.getValue(); 
        var index = $('.tab.z-selected').index();
        sources[index].text = currentValue;
    }

    $(document).on('click', '.tab',  function() {
        saveValue();
        $(this).addClass('z-selected').siblings().removeClass('z-selected');
        var curIndex = $(this).index();
        setEditor(sources[curIndex]);

    });


    var iframe = document.getElementsByTagName('iframe')[0];

    function sendCode() {
        var messageValue = JSON.stringify({
            parts: sources
        });
        iframe.contentWindow.postMessage(messageValue, '*');
    }

    // Do the things we need to do to initialize state
    window.addEventListener('message', function(e) {
        var message = JSON.parse(e.data);
        switch (message.messageType) {
            case 'ready': 
                sendCode();
                break;
            case 'evaluate':
                var result = '';
                console.log(message);
                result += message.isCorrect === 'true' ? '答对了' : '答错了';
                result += ( '\n' +message.comment );
                alert(result);
            default:
                //
        }

    });

    // 初始话第一个
    setEditor(sources[0])
</script>
</body>
</html>
