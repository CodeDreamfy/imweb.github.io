{"version":3,"sources":["Datepicker.jsx"],"names":[],"mappings":"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","file":"Datepicker.jsx","sourcesContent":["/**\r\n * imui.Datepicker\r\n * @author riverhan\r\n * @data 2016-8-10\r\n *\r\n * @todo unit test\r\n * @todo 注释\r\n */\r\n\r\nimport React, { PropTypes } from 'react';\r\nimport ReactDom from 'react-dom';\r\nimport classnames from 'classnames';\r\nimport DateInput from './DateInput';\r\nimport Calendar from './Calendar';\r\nimport { getPureDate, isSameDate } from './dateUtils';\r\nimport { getElementLeft, getElementTop } from './positionUtil';\r\n\r\nconst renderSubtreeIntoContainer = ReactDom.unstable_renderSubtreeIntoContainer;\r\n\r\nclass Datepicker extends React.Component {\r\n  static PropTypes = {\r\n    inline: PropTypes.bool, // 不依附Input标签，直接展示inline的calendar\r\n    selected: PropTypes.object, // 当前选中的日期\r\n    initMonth: PropTypes.object, // 日期选择器打开时显示的日期所在月分\r\n    showPicker: PropTypes.bool, // 是否初始展示选择器\r\n    className: PropTypes.string, // 选择器自定义className\r\n    onChange: PropTypes.func, // 目标日期改变时的回调函数\r\n    onChangeMonth: PropTypes.func, // 月份切换时的回调函数\r\n    minDate: PropTypes.object, // 选择器允许选择的最小日期\r\n    maxDate: PropTypes.object, // 选择器允许选择的最大日期\r\n    placeholder: PropTypes.string, // 输入框的placeholder\r\n    calendarZindex: PropTypes.number, // 输入框的placeholder\r\n    showIcon: PropTypes.bool, // 是否在输入框中显示日历icon，仅在非inline模式下有效\r\n    showClean: PropTypes.bool, // 是否在输入框中显示清空按钮，仅在非inline模式下有效\r\n    disabled: PropTypes.bool, // 是否禁用datepicker操作？\r\n    dateFormat: PropTypes.string // 输入框的输出格式 'YYYY-MM-DD'\r\n  };\r\n\r\n  static defaultProps = {\r\n    showPicker: false,\r\n    onChange: () => {},\r\n    onChangeMonth: () => {},\r\n    dateFormat: 'YYYY-MM-DD',\r\n    showIcon: false,\r\n    showClean: false,\r\n    disabled: false\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.handleSelect = this.handleSelect.bind(this);\r\n    this.handleInputClick = this.handleInputClick.bind(this);\r\n    this.handleClickOutPicker = this.handleClickOutPicker.bind(this);\r\n    this.handleClean = this.handleClean.bind(this);\r\n\r\n    this.state = {\r\n      selected: this.props.selected && new Date(this.props.selected),\r\n      showPicker: this.props.showPicker\r\n    };\r\n  }\r\n\r\n  handleSelect(date) {\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n\r\n    if (!isSameDate(date, this.state.selected)) {\r\n      this.props.onChange(getPureDate(date), getPureDate(this.state.selected));\r\n    }\r\n\r\n    this.setState({\r\n      showPicker: false,\r\n      selected: getPureDate(date)\r\n    });\r\n  }\r\n\r\n  handleInputClick() {\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      showPicker: !this.state.showPicker\r\n    });\r\n  }\r\n\r\n  handleClean(event) {\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      selected: undefined\r\n    });\r\n\r\n    if (this.state.selected) {\r\n      this.props.onChange(undefined, getPureDate(this.state.selected));\r\n    }\r\n    event.stopPropagation();\r\n  }\r\n\r\n  handleClickOutPicker() {\r\n    this.setState({\r\n      showPicker: false\r\n    });\r\n  }\r\n\r\n  componentDidMount() {\r\n    const body = document.body;\r\n    const container = this.container = document.createElement('div');\r\n\r\n    body.appendChild(container);\r\n    this.renderCalendarToBody();\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.renderCalendarToBody();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.container) {\r\n      ReactDom.unmountComponentAtNode(this.container);\r\n    }\r\n  }\r\n\r\n  renderCalendarToBody() {\r\n    const { inline } = this.props;\r\n\r\n    if (!inline) { // 非inline模式下，需要将calendar渲染到body下，防止z-index问题\r\n      const elemInput = this.refs.dpInput.refs.input;\r\n      const position = {\r\n        left: getElementLeft(elemInput),\r\n        top: getElementTop(elemInput) + elemInput.offsetHeight\r\n      };\r\n\r\n      renderSubtreeIntoContainer(this,\r\n        <Calendar\r\n          {...position}\r\n          inline={inline}\r\n          zIndex={this.props.calendarZindex}\r\n          selected={this.state.selected}\r\n          day={this.props.initMonth}\r\n          onSelect={this.handleSelect}\r\n          show={this.state.showPicker}\r\n          handleClickOutPicker={this.handleClickOutPicker}\r\n          disableOnClickOutside={!this.state.showPicker || inline}\r\n          handleChangeMonth={this.props.onChangeMonth}\r\n          eventTypes=\"click\"\r\n          minDate={this.props.minDate}\r\n          maxDate={this.props.maxDate}\r\n        />, this.container\r\n      );\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { inline } = this.props;\r\n\r\n    return (\r\n      <div className={classnames('im-datepicker', this.props.className)}>\r\n        {inline ? <Calendar\r\n          inline={inline}\r\n          selected={this.state.selected}\r\n          day={this.props.initMonth}\r\n          onSelect={this.handleSelect}\r\n          show={this.state.showPicker}\r\n          handleClickOutPicker={this.handleClickOutPicker}\r\n          disableOnClickOutside={!this.state.showPicker || inline}\r\n          handleChangeMonth={this.props.onChangeMonth}\r\n          eventTypes=\"click\"\r\n          minDate={this.props.minDate}\r\n          maxDate={this.props.maxDate}\r\n        /> : <DateInput\r\n          ref=\"dpInput\"\r\n          disabled={this.props.disabled}\r\n          showClean={this.props.showClean}\r\n          showIcon={this.props.showIcon}\r\n          selected={this.state.selected}\r\n          onInputClick={this.handleInputClick}\r\n          placeholder={this.props.placeholder}\r\n          dateFormat={this.props.dateFormat}\r\n          handleClean={this.handleClean}\r\n        />}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Datepicker;\r\n"]}