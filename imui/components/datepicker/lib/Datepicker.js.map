{"version":3,"sources":["Datepicker.jsx"],"names":[],"mappings":"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","file":"Datepicker.jsx","sourcesContent":["/**\r\n * imui.Datepicker\r\n * @author riverhan\r\n * @data 2016-8-10\r\n *\r\n * @todo unit test\r\n * @todo 注释\r\n */\r\n\r\nimport React, { PropTypes } from 'react';\r\nimport ReactDom from 'react-dom';\r\nimport classnames from 'classnames';\r\nimport DateInput from './DateInput';\r\nimport Calendar from './Calendar';\r\nimport { getPureDate, isSameDate, getDayOfWeek } from './dateUtils';\r\nimport { getElementLeft, getElementTop } from './positionUtil';\r\n\r\nconst renderSubtreeIntoContainer = ReactDom.unstable_renderSubtreeIntoContainer;\r\n\r\nclass Datepicker extends React.Component {\r\n  static PropTypes = {\r\n    inline: PropTypes.bool, // 不依附Input标签，直接展示inline的calendar\r\n    selected: PropTypes.instanceOf(Date), // 当前选中的日期\r\n    selectedWeek: PropTypes.instanceOf(Date), // 当前选中的周中的一天\r\n    selectedRange: PropTypes.shape({ // 当前选中的日期范围,为两个元素的数组\r\n      from: PropTypes.instanceOf(Date),\r\n      to: PropTypes.instanceOf(Date)\r\n    }),\r\n    rangeJoin: PropTypes.string, // 显示范围日期的连接字符串\r\n    initMonth: PropTypes.instanceOf(Date), // 日期选择器打开时显示的日期所在月分\r\n    showPicker: PropTypes.bool, // 是否初始展示选择器\r\n    className: PropTypes.string, // 选择器自定义className\r\n    onChange: PropTypes.func, // 目标日期改变时的回调函数\r\n    onChangeMonth: PropTypes.func, // 月份切换时的回调函数\r\n    minDate: PropTypes.instanceOf(Date), // 选择器允许选择的最小日期\r\n    maxDate: PropTypes.instanceOf(Date), // 选择器允许选择的最大日期\r\n    placeholder: PropTypes.string, // 输入框的placeholder\r\n    calendarZindex: PropTypes.number, // 非inline模式下日历的z-index\r\n    showIcon: PropTypes.bool, // 是否在输入框中显示日历icon，仅在非inline模式下有效\r\n    showClean: PropTypes.bool, // 是否在输入框中显示清空按钮，仅在非inline模式下有效\r\n    disabled: PropTypes.bool, // 是否禁用datepicker操作\r\n    weekMode: PropTypes.bool, // 是否启用周选模式\r\n    inputWidth: PropTypes.number, // input展示框的宽度（算上padding和border）\r\n    dateFormat: PropTypes.string // 输入框的输出格式 'YYYY-MM-DD'\r\n  };\r\n\r\n  static defaultProps = {\r\n    showPicker: false,\r\n    onChange: () => {},\r\n    onChangeMonth: () => {},\r\n    dateFormat: 'YYYY-MM-DD',\r\n    showIcon: false,\r\n    showClean: false,\r\n    disabled: false,\r\n    weekMode: false,\r\n    rangeJoin: ' 至 '\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.handleSelect = this.handleSelect.bind(this);\r\n    this.handleInputClick = this.handleInputClick.bind(this);\r\n    this.handleClickOutPicker = this.handleClickOutPicker.bind(this);\r\n    this.handleClean = this.handleClean.bind(this);\r\n\r\n    this.initState();\r\n  }\r\n\r\n  initState() {\r\n    const { selectedWeek, selectedRange } = this.props;\r\n    let selectedRangeState;\r\n\r\n    if (selectedWeek) {\r\n      selectedRangeState = {\r\n        from: getDayOfWeek(selectedWeek, 0),\r\n        to: getDayOfWeek(selectedWeek, 6)\r\n      };\r\n    } else if (selectedRange) {\r\n      selectedRangeState = {\r\n        from: selectedRange.from,\r\n        to: selectedRange.to\r\n      };\r\n    } else {\r\n      selectedRangeState = null;\r\n    }\r\n\r\n    this.state = {\r\n      selected: this.props.selected && new Date(this.props.selected),\r\n      showPicker: this.props.showPicker,\r\n      selectedRange: selectedRangeState\r\n    };\r\n  }\r\n\r\n  handleSelect(date) {\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n\r\n    if (!this.props.weekMode) { // 非week式时的回调\r\n      let selectedNew = getPureDate(date);\r\n\r\n      if (!isSameDate(selectedNew, this.state.selected)) { // 选择的日期有变动\r\n        this.props.onChange(selectedNew, getPureDate(this.state.selected));\r\n      }\r\n\r\n      this.setState({\r\n        showPicker: false,\r\n        selected: selectedNew\r\n      });\r\n    } else if (this.props.weekMode) { // week模式\r\n      let rangeNew = {\r\n        from: getDayOfWeek(date, 0),\r\n        to: getDayOfWeek(date, 6)\r\n      };\r\n      const selectedRange = this.state.selectedRange || null;\r\n\r\n      if (selectedRange === null ||\r\n        !isSameDate(rangeNew.from, selectedRange.from)) {\r\n        this.props.onChange(rangeNew, selectedRange);\r\n      }\r\n\r\n      this.setState({\r\n        showPicker: false,\r\n        selectedRange: rangeNew\r\n      });\r\n    }\r\n  }\r\n\r\n  handleInputClick() {\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      showPicker: !this.state.showPicker\r\n    });\r\n  }\r\n\r\n  handleClean(event) {\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      selected: undefined,\r\n      selectedRange: null\r\n    });\r\n\r\n    if (this.state.selected) {\r\n      this.props.onChange(undefined, getPureDate(this.state.selected));\r\n    }\r\n    event.stopPropagation();\r\n  }\r\n\r\n  handleClickOutPicker() {\r\n    this.setState({\r\n      showPicker: false\r\n    });\r\n  }\r\n\r\n  componentDidMount() {\r\n    const body = document.body;\r\n    const container = this.container = document.createElement('div');\r\n\r\n    body.appendChild(container);\r\n    this.renderCalendarToBody();\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.renderCalendarToBody();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.container) {\r\n      ReactDom.unmountComponentAtNode(this.container);\r\n    }\r\n  }\r\n\r\n  renderCalendarToBody() {\r\n    const { inline } = this.props;\r\n\r\n    if (!inline) { // 非inline模式下，需要将calendar渲染到body下，防止z-index问题\r\n      const elemInput = this.refs.dpInput.refs.input;\r\n      const position = {\r\n        left: getElementLeft(elemInput),\r\n        top: getElementTop(elemInput) + elemInput.offsetHeight\r\n      };\r\n\r\n      renderSubtreeIntoContainer(this,\r\n        <Calendar\r\n          {...position}\r\n          inline={inline}\r\n          zIndex={this.props.calendarZindex}\r\n          selected={this.state.selected}\r\n          day={this.props.initMonth}\r\n          onSelect={this.handleSelect}\r\n          show={this.state.showPicker}\r\n          handleClickOutPicker={this.handleClickOutPicker}\r\n          disableOnClickOutside={!this.state.showPicker || inline}\r\n          handleChangeMonth={this.props.onChangeMonth}\r\n          eventTypes=\"click\"\r\n          minDate={this.props.minDate}\r\n          maxDate={this.props.maxDate}\r\n          weekMode={this.props.weekMode}\r\n          selectedRange={this.state.selectedRange}\r\n        />, this.container\r\n      );\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { inline } = this.props;\r\n\r\n    return (\r\n      <div className={classnames('im-datepicker', this.props.className)}>\r\n        {inline ? <Calendar\r\n          inline={inline}\r\n          selected={this.state.selected}\r\n          day={this.props.initMonth}\r\n          onSelect={this.handleSelect}\r\n          show={this.state.showPicker}\r\n          handleClickOutPicker={this.handleClickOutPicker}\r\n          disableOnClickOutside={!this.state.showPicker || inline}\r\n          handleChangeMonth={this.props.onChangeMonth}\r\n          eventTypes=\"click\"\r\n          minDate={this.props.minDate}\r\n          maxDate={this.props.maxDate}\r\n          weekMode={this.props.weekMode}\r\n          selectedRange={this.state.selectedRange}\r\n        /> : <DateInput\r\n          ref=\"dpInput\"\r\n          disabled={this.props.disabled}\r\n          showClean={this.props.showClean}\r\n          showIcon={this.props.showIcon}\r\n          selected={this.state.selected}\r\n          onInputClick={this.handleInputClick}\r\n          placeholder={this.props.placeholder}\r\n          dateFormat={this.props.dateFormat}\r\n          handleClean={this.handleClean}\r\n          rangeMode={this.props.weekMode}\r\n          selectedRange={this.state.selectedRange}\r\n          rangeJoin={this.props.rangeJoin}\r\n          inputWidth={this.props.inputWidth}\r\n        />}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Datepicker;\r\n"]}