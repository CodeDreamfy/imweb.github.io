{"version":3,"sources":["Form.Mixin.jsx"],"names":[],"mappings":"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","file":"Form.Mixin.jsx","sourcesContent":["/**\r\n * imui.Form.Mixin\r\n * @author moxhe\r\n * @date 2016-08-15\r\n */\r\n\r\nimport { PropTypes } from 'react';\r\nimport Validator from './validator';\r\n\r\nexport default {\r\n  propTypes: {\r\n    // 决定是否进行校验的标志\r\n    isChecking: PropTypes.bool,\r\n    // 内置校验的模式，支持的模式请查看validator.js\r\n    patterns: PropTypes.string,\r\n    // 内置模式对应的提示信息\r\n    // todo：利用占位符动态替换当前value\r\n    tips: PropTypes.string,\r\n    // 外置模式的校验函数,支持异步\r\n    validator: PropTypes.func,\r\n    // disabled状态\r\n    disabled: PropTypes.bool,\r\n    // name\r\n    name: PropTypes.string\r\n  },\r\n\r\n  contextTypes: {\r\n    // 配合Form组件使用时，context对象属性\r\n    form: PropTypes.object\r\n  },\r\n\r\n  getInitialState() {\r\n    const {\r\n      value,\r\n      defaultValue,\r\n      isChecking,\r\n      disabled\r\n    } = this.props;\r\n\r\n    return {\r\n      value,\r\n      defaultValue,\r\n      isChecking,\r\n      disabled,\r\n      isValid: true,\r\n      msgs: []\r\n    };\r\n  },\r\n\r\n  getDefaultProps() {\r\n    return {\r\n      // isChecking的缺省值应由表单组件本身所决定\r\n      // isChecking: true,\r\n      disabled: false,\r\n      patterns: '',\r\n      tips: '',\r\n      validator: null\r\n    };\r\n  },\r\n\r\n  // 传递this实例配合Form组件使用\r\n  // 构建Form APIs\r\n  componentWillMount() {\r\n    if (this.context.form) {\r\n      if (!this.props.name) {\r\n        throw new Error('Form field requires a name property when used');\r\n      }\r\n\r\n      this.context.form.attachField(this.props.name, this);\r\n    }\r\n  },\r\n\r\n  // 校验API\r\n  checkSelf() {\r\n    if (!this.state.isChecking) {\r\n      return;\r\n    }\r\n\r\n    let { patterns, tips, validator } = this.props;\r\n    let msgs = [];\r\n\r\n    patterns = patterns.split('|');\r\n    tips = tips.split('|');\r\n\r\n    // 内置校验\r\n    patterns.forEach((pattern, i) => {\r\n      if (!pattern) {\r\n        return;\r\n      }\r\n      if (!Validator[pattern]) {\r\n        throw new Error(`[validator ${pattern}]not exist.`);\r\n      }\r\n\r\n      let data = this.props[`data-${pattern}`];\r\n      let flag = Validator[pattern](this.state.value, data);\r\n      if (!flag) {\r\n        msgs.push(tips[i]);\r\n      }\r\n    });\r\n\r\n    // 支持异步\r\n    if (!validator) {\r\n      return this.setMsgs(msgs);\r\n    }\r\n    validator(this.state.value, (result) => {\r\n      if (!result.isValid) {\r\n        msgs = msgs.concat(result.msgs);\r\n      }\r\n\r\n      this.setMsgs(msgs);\r\n    });\r\n  },\r\n\r\n  getValue() {\r\n    const { value, defaultValue } = this.state;\r\n\r\n    return value || defaultValue;\r\n  },\r\n\r\n  setValue(value, notCheck) {\r\n    this.setState({\r\n      value\r\n    }, () => {\r\n      if (!notCheck) {\r\n        this.checkSelf();\r\n      }\r\n    });\r\n  },\r\n\r\n  getMsgs() {\r\n    return this.state.msgs;\r\n  },\r\n\r\n  setMsgs(msgs) {\r\n    const isValid = !msgs.length;\r\n\r\n    this.setState({ msgs, isValid });\r\n  },\r\n\r\n  isDisabled() {\r\n    return this.state.disabled;\r\n  },\r\n\r\n  setDisabled(disabled) {\r\n    this.setState({ disabled });\r\n  },\r\n\r\n  toggleChecking(flag) {\r\n    let isChecking = flag || this.state.isChecking;\r\n\r\n    this.setState({ isChecking });\r\n  },\r\n\r\n  isValid() {\r\n    return this.state.isValid;\r\n  }\r\n};\r\n"]}